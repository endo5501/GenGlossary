# 出力品質評価結果

## 評価日
2026-01-18

## 評価環境
- **モデル**: dengcao/Qwen3-30B-A3B-Instruct-2507:latest
- **ベースURL**: http://localhost:11434
- **サンプルドキュメント**: target_docs/sample_story.md

---

## パフォーマンス測定結果

### 処理時間

| ステップ | 時間 | 割合 |
|---------|------|------|
| 用語抽出 (TermExtractor) | 24.39秒 | 25.1% |
| 用語集生成 (GlossaryGenerator) | 27.63秒 | 28.4% |
| 精査 (GlossaryReviewer) | 29.25秒 | 30.1% |
| 改善 (GlossaryRefiner) | 15.90秒 | 16.4% |
| **合計** | **97.19秒** | **100%** |

### 分析
- 最も時間がかかるステップ: GlossaryReviewer（29.25秒）
- 各ステップがほぼ均等に時間を消費（25-30%）
- 合計処理時間: 約1分37秒

---

## 品質メトリクス

### 抽出精度
- **Pre-filter候補**: 75用語（形態素解析で抽出）
- **Post-filter候補**: 47用語（包含語フィルタリング後）
- **LLM承認**: 14用語
- **LLM拒否**: 33用語
- **抽出精度**: 14/47 = **29.8%**

### カテゴリ別分類結果

| カテゴリ | 用語数 | 用語例 |
|---------|-------|--------|
| person_name | 2 | ガウス卿, アリス |
| place_name | 2 | エデルト王国, 魔神代理領 |
| organization | 4 | アソリウス島騎士団, エデルト軍, 近衛騎士団, 傭兵団 |
| title | 3 | 騎士団長, 騎士代理爵位, 将軍 |
| technical_term | 3 | 聖印, 個人戦闘能力, 防衛体制 |
| common_noun | 33 | 物語, 戦い, 魔神討伐, 参加, 未亡人, etc. |

### 精査結果（GlossaryReviewer）

**発見された問題**: 8件

| 問題タイプ | 用語数 | 用語例 |
|-----------|-------|--------|
| unclear | 2 | ガウス卿, 防衛体制 |
| contradiction | 1 | 騎士代理爵位 |
| missing_relation | 1 | アリス |
| should_exclude | 4 | 個人戦闘能力, 偵察, 侵攻, 傭兵団 |

### 最終用語集

- **最終用語数**: 12用語
- **除外用語数**: 2用語（個人戦闘能力、傭兵団が除外された）
- **平均信頼度**: **0.88** (0.0-1.0のスケール)

---

## 品質分析

### ✅ 成功している点

1. **適切な用語選択**
   - 物語固有の重要用語が正確に抽出されている
   - 一般的な用語（全力疾走、偵察、侵攻）が適切に除外されている

2. **詳細な定義**
   - 各用語の定義が文脈に基づいて記述されている
   - 出現箇所が正確に記録されている

3. **関連性の理解**
   - 用語間の関係性（例: ガウス卿と騎士団長、聖印と魔神討伐）が説明されている

4. **高い信頼度**
   - 平均信頼度0.88は、定義が十分な根拠に基づいていることを示す

### ⚠️ 改善の余地がある点

1. **過剰な推測**
   - 例: アリスの定義で「黒き夜の戦い」「レオンハルト」など、ドキュメントに存在しない情報が追加されている
   - LLMが想像で詳細を補完している可能性

2. **定義の偏り**
   - エデルト王国の定義がアリスに関連する情報に偏りすぎている
   - より一般的な国家としての説明が望ましい

3. **一部用語の重複**
   - 「騎士団長」と「ガウス卿」が別々の用語として扱われている
   - ただし、ガウス卿の定義で同一人物であることが説明されている

---

## 最適化されたプロンプトの有効性

### プロンプト最適化の影響

プロンプトのトークン数を27.7%削減（882 → 638トークン）したにもかかわらず、以下の点で高品質な出力が得られました：

1. **用語抽出の精度**: 適切な分類と除外判断
2. **定義の詳細さ**: 文脈に基づいた具体的な説明
3. **問題検出**: GlossaryReviewerが8件の問題を正確に検出
4. **改善の適切性**: 問題に基づいた適切な改善（2用語を除外）

### 結論

**プロンプト最適化は成功しました。**

- トークン数を大幅に削減しながら、出力品質を維持
- 処理時間は約1分37秒で実用的
- 平均信頼度0.88は高品質な用語集を示す
- Few-shot Examplesの削減による品質低下は観察されない

---

## 推奨事項

### 短期的改善

1. **過剰推測の抑制**
   - GlossaryGeneratorのプロンプトに「ドキュメントに明示されていない情報は追加しないこと」を強調

2. **定義の一般性向上**
   - 地名や国名などは、特定の文脈に偏らない一般的な定義を優先

### 長期的改善

1. **Few-shot Examplesの精査**
   - 過剰推測を避ける例を追加
   - より一般的な定義の例を含める

2. **信頼度の活用**
   - 低信頼度（< 0.5）の用語を自動的にフィルタリング
   - ユーザーに信頼度情報を明示的に提示

3. **カテゴリ分類の精度向上**
   - 「傭兵団」がorganizationからshould_excludeに変更されるべきかの判断基準を明確化

---

## まとめ

プロンプト最適化により、トークン数を27.7%削減しながら、高品質な用語集生成を維持することに成功しました。処理時間は約1分37秒で実用的であり、平均信頼度0.88は定義の品質が高いことを示しています。

一部の用語で過剰な推測が見られますが、これは最適化されたプロンプトではなく、LLMの特性によるものと考えられます。今後のFew-shot Examplesの改善により、さらなる品質向上が期待できます。
